<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>javascript设计模式之装饰者模式 | 大前端宝典</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" content="每天至少一个问题，有关前端，后端，graphql，devops，微服务以及软技能，促进个人职业成长，敲开大厂之门。">
    <link rel="preload" href="/assets/css/0.styles.49f7e903.css" as="style"><link rel="preload" href="/assets/js/app.09cb6e35.js" as="script"><link rel="preload" href="/assets/js/2.925a6821.js" as="script"><link rel="preload" href="/assets/js/67.cd7385f8.js" as="script"><link rel="prefetch" href="/assets/js/10.98a36629.js"><link rel="prefetch" href="/assets/js/11.ceed1adf.js"><link rel="prefetch" href="/assets/js/12.d31ffce0.js"><link rel="prefetch" href="/assets/js/13.3b68a581.js"><link rel="prefetch" href="/assets/js/14.f1139b2b.js"><link rel="prefetch" href="/assets/js/15.c20f7f64.js"><link rel="prefetch" href="/assets/js/16.da345693.js"><link rel="prefetch" href="/assets/js/17.098a94fa.js"><link rel="prefetch" href="/assets/js/18.f8ff70d8.js"><link rel="prefetch" href="/assets/js/19.c38103e4.js"><link rel="prefetch" href="/assets/js/20.989c95b6.js"><link rel="prefetch" href="/assets/js/21.c1a29603.js"><link rel="prefetch" href="/assets/js/22.436b2705.js"><link rel="prefetch" href="/assets/js/23.b1a2e306.js"><link rel="prefetch" href="/assets/js/24.854bff80.js"><link rel="prefetch" href="/assets/js/25.b237ff06.js"><link rel="prefetch" href="/assets/js/26.e0edd037.js"><link rel="prefetch" href="/assets/js/27.6b121690.js"><link rel="prefetch" href="/assets/js/28.a2db7f3a.js"><link rel="prefetch" href="/assets/js/29.4ccac805.js"><link rel="prefetch" href="/assets/js/3.d14819b5.js"><link rel="prefetch" href="/assets/js/30.d96d914b.js"><link rel="prefetch" href="/assets/js/31.618315fc.js"><link rel="prefetch" href="/assets/js/32.ab9392b0.js"><link rel="prefetch" href="/assets/js/33.07d9d897.js"><link rel="prefetch" href="/assets/js/34.268d9daf.js"><link rel="prefetch" href="/assets/js/35.eaf2c0d1.js"><link rel="prefetch" href="/assets/js/36.36cc4419.js"><link rel="prefetch" href="/assets/js/37.20634a0a.js"><link rel="prefetch" href="/assets/js/38.6c5cf63e.js"><link rel="prefetch" href="/assets/js/39.5f9e69c7.js"><link rel="prefetch" href="/assets/js/4.156b45c1.js"><link rel="prefetch" href="/assets/js/40.07dd1ca1.js"><link rel="prefetch" href="/assets/js/41.bff794d9.js"><link rel="prefetch" href="/assets/js/42.3fa3ab70.js"><link rel="prefetch" href="/assets/js/43.0e3c53d2.js"><link rel="prefetch" href="/assets/js/44.c358e593.js"><link rel="prefetch" href="/assets/js/45.43a8358b.js"><link rel="prefetch" href="/assets/js/46.716cc74a.js"><link rel="prefetch" href="/assets/js/47.f27a19d8.js"><link rel="prefetch" href="/assets/js/48.f20fc33d.js"><link rel="prefetch" href="/assets/js/49.88e057de.js"><link rel="prefetch" href="/assets/js/5.58b647e2.js"><link rel="prefetch" href="/assets/js/50.57f61c41.js"><link rel="prefetch" href="/assets/js/51.cb82db46.js"><link rel="prefetch" href="/assets/js/52.64de880b.js"><link rel="prefetch" href="/assets/js/53.913b3da0.js"><link rel="prefetch" href="/assets/js/54.8c773b8e.js"><link rel="prefetch" href="/assets/js/55.78b88265.js"><link rel="prefetch" href="/assets/js/56.e712e7b1.js"><link rel="prefetch" href="/assets/js/57.f897bf7c.js"><link rel="prefetch" href="/assets/js/58.81336c48.js"><link rel="prefetch" href="/assets/js/59.132c9a71.js"><link rel="prefetch" href="/assets/js/6.e9834e62.js"><link rel="prefetch" href="/assets/js/60.fb7224c2.js"><link rel="prefetch" href="/assets/js/61.ad79aff7.js"><link rel="prefetch" href="/assets/js/62.5f6c3b5c.js"><link rel="prefetch" href="/assets/js/63.ae7edb8f.js"><link rel="prefetch" href="/assets/js/64.c7f28dc8.js"><link rel="prefetch" href="/assets/js/65.e6a5c763.js"><link rel="prefetch" href="/assets/js/66.a92e3ae6.js"><link rel="prefetch" href="/assets/js/68.ee0077af.js"><link rel="prefetch" href="/assets/js/69.9254be03.js"><link rel="prefetch" href="/assets/js/7.403a9dd0.js"><link rel="prefetch" href="/assets/js/70.108f08d9.js"><link rel="prefetch" href="/assets/js/71.4fa5838b.js"><link rel="prefetch" href="/assets/js/72.9088e97b.js"><link rel="prefetch" href="/assets/js/73.e622d09d.js"><link rel="prefetch" href="/assets/js/74.e8b5e845.js"><link rel="prefetch" href="/assets/js/8.214f86ec.js"><link rel="prefetch" href="/assets/js/9.ab2ace72.js">
    <link rel="stylesheet" href="/assets/css/0.styles.49f7e903.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">大前端宝典</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/house/" class="nav-link">
  house
</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">
  大前端
</a></div><div class="nav-item"><a href="/backend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  数据结构与算法
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/house/" class="nav-link">
  house
</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">
  大前端
</a></div><div class="nav-item"><a href="/backend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  数据结构与算法
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/front/" aria-current="page" class="sidebar-link">目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front/js/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/front/js/1.html" class="sidebar-link">in 运算符和 Object.hasOwnProperty 方法有什么区别？⭐️</a></li><li><a href="/front/js/3.html" class="sidebar-link">什么是事件传播？⭐️</a></li><li><a href="/front/js/4.html" class="sidebar-link">深入理解javascript原型和闭包之[一切都是对象]⭐️</a></li><li><a href="/front/js/5.html" class="sidebar-link">深入理解javascript原型和闭包之[函数和对象的关系]⭐️</a></li><li><a href="/front/js/6.html" class="sidebar-link">深入理解javascript原型和闭包之[prototype原型]⭐️</a></li><li><a href="/front/js/7.html" class="sidebar-link">深入理解javascript原型和闭包之[隐式原型]⭐️</a></li><li><a href="/front/js/8.html" class="sidebar-link">深入理解javascript原型和闭包之[instanceof]</a></li><li><a href="/front/js/9.html" class="sidebar-link">深入理解javascript原型和闭包之[继承]⭐️</a></li><li><a href="/front/js/10.html" class="sidebar-link">深入理解javascript原型和闭包之[简述执行上下文-上]⭐️</a></li><li><a href="/front/js/11.html" class="sidebar-link">深入理解javascript原型和闭包之[简述执行上下文-下]⭐️</a></li><li><a href="/front/js/12.html" class="sidebar-link">深入理解javascript原型和闭包之[this]⭐️</a></li><li><a href="/front/js/13.html" class="sidebar-link">深入理解javascript原型和闭包之[执行上下文栈]⭐️</a></li><li><a href="/front/js/14.html" class="sidebar-link">深入理解javascript原型和闭包之[简介--作用域]⭐️</a></li><li><a href="/front/js/15.html" class="sidebar-link">深入理解javascript原型和闭包之[作用域和执行上下文环境]⭐️</a></li><li><a href="/front/js/16.html" class="sidebar-link">深入理解javascript原型和闭包之[从自由变量到作用域链]⭐️</a></li><li><a href="/front/js/17.html" class="sidebar-link">深入理解javascript原型和闭包之[闭包一]⭐️</a></li><li><a href="/front/js/18.html" class="sidebar-link">深入理解javascript原型和闭包之[闭包二]⭐️</a></li><li><a href="/front/js/19.html" class="sidebar-link">防抖和节流原理分析--防抖⭐️</a></li><li><a href="/front/js/20.html" class="sidebar-link">防抖和节流原理分析--节流⭐️</a></li><li><a href="/front/js/21.html" class="sidebar-link">Promise里的代码为什么比setTimeout先执行？⭐️</a></li><li><a href="/front/js/22.html" class="sidebar-link">如何写出一个惊艳面试官的深拷贝？⭐️</a></li><li><a href="/front/js/23.html" class="sidebar-link">javascript设计模式之单例模式 ⭐️</a></li><li><a href="/front/js/24.html" class="sidebar-link">javascript设计模式之构造函数模式 ⭐️</a></li><li><a href="/front/js/25.html" class="sidebar-link">javascript设计模式之建造者模式 ⭐️</a></li><li><a href="/front/js/26.html" class="sidebar-link">javascript设计模式之工厂模式 ⭐️</a></li><li><a href="/front/js/27.html" aria-current="page" class="active sidebar-link">javascript设计模式之装饰者模式 ⭐</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/front/js/28.html" class="sidebar-link">javascript设计模式之外观模式 ⭐</a></li><li><a href="/front/js/48.html" class="sidebar-link">javascript的new操作都做了什么？⭐️</a></li><li><a href="/front/js/49.html" class="sidebar-link">JavaScript可视化：Promise和Async/Await？⭐️</a></li><li><a href="/front/js/50.html" class="sidebar-link">javascript中Proxy和defineProperty对比 ⭐️</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>element</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="javascript设计模式之装饰者模式"><a href="#javascript设计模式之装饰者模式" class="header-anchor">#</a> javascript设计模式之装饰者模式</h3> <p><strong>介绍</strong></p> <p>装饰者提供比继承更有弹性的替代方案。 装饰者用于包装同接口的对象，不仅允许你向方法添加行为，而且还可以将方法设置成原始对象调用（例如装饰者的构造函数）。</p> <p>装饰者用于通过重载方法的形式添加新功能，该模式可以在被装饰者前面或者后面加上自己的行为以达到特定的目的。</p> <p><strong>特点</strong></p> <p>装饰者模式的特点：</p> <ol><li><p>在不改变原对象的原本结构的情况下进行功能添加。</p></li> <li><p>装饰对象和原对象具有相同的接口，可以使客户以与原对象相同的方式使用装饰对象。</p></li> <li><p>装饰对象中包含原对象的引用，即装饰对象是真正的原对象经过包装后的对象。</p></li></ol> <p><strong>正文</strong></p> <p>装饰者模式中，可以在运行时动态添加附加功能到对象中。当处理静态类时，这可能是一个挑战。在Javascript中，由于对象是可变的，因此，添加功能到对象中的过程本身并不是问题。</p> <p>装饰者模式的一个比较方便的特征在于其预期行为的可定制和可配置特性。可以从仅具有一些基本功能的普通对象开始，然后从可用装饰资源池中选择需要用于增强普通对象的哪些功能，并且按照顺序进行装饰，尤其是当装饰顺序很重要的时候。</p> <p>实现装饰者模式的其中一个方法是使得每个装饰者成为一个对象，并且该对象包含了应该被重载的方法。</p> <p>每个装饰者实际上继承了目前已经被前一个装饰者进行增强后的对象。</p> <p>每个装饰方法在“继承的对象”上调用了同样的方法并获取其值，此外它还继续执行了一些操作。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//需要装饰的类（函数）</span>
<span class="token keyword">function</span> <span class="token function">Macbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cost</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//计算商品的包装费</span>
<span class="token keyword">function</span> <span class="token function">PackagingFee</span><span class="token punctuation">(</span><span class="token parameter">macbook</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cost</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> macbook<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">75</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//计算商品的运费</span>
<span class="token keyword">function</span> <span class="token function">Freight</span><span class="token punctuation">(</span><span class="token parameter">macbook</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cost</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> macbook<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">300</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//计算商品的保险费用</span>
<span class="token keyword">function</span> <span class="token function">Insurance</span><span class="token punctuation">(</span><span class="token parameter">macbook</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cost</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> macbook<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">250</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 用法</span>
<span class="token keyword">var</span> myMacbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Insurance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Freight</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PackagingFee</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Macbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myMacbook<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1625</span>
</code></pre></div><p>我们简单的分析下上面的代码，上面的代码中，一共定义了四个函数（其中一个需要修饰的函数，三个用于修饰的函数）。</p> <p>然后，声明一个变量myMacbook指向new出来的Insurance对象，Insurance对象的形参指向new出来的Freight对象，Freight对象的形参指向new出来的PackagingFee对象，PackagingFee对象的形参指向new出来的Macbook对象。</p> <p>接下来，调用myMacbook的cost方法。从上面的分析，我们可以得出 myMacbook.cost()的值等于（Freight对象的cost方法+250），Freight对象的cost方法等于（PackagingFee对象的cost方法+300），PackagingFee对象的cost方法等于（Macbook对象的cost方法+75）。 所以最终的结果是：myMacbook.cost()的值 = 250 + (300 + (75 + 1000)) = 1625。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 用法</span>
<span class="token keyword">var</span> myMacbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Insurance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Freight</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PackagingFee</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Macbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myMacbook<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1625</span>
<span class="token comment">//上面的代码等价于下面拆分后的代码，或许拆分后代码你更能看出前后的逻辑性</span>
<span class="token keyword">var</span> macbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Macbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token keyword">package</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PackagingFee</span><span class="token punctuation">(</span>macbook<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> freight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Freight</span><span class="token punctuation">(</span><span class="token keyword">package</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myMacbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Insurance</span><span class="token punctuation">(</span>freight<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//当然，如果你不想声明这么多变量（macbook、package、freight），只用一个变量也是可以的</span>
<span class="token keyword">var</span> macbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Macbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
macbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PackagingFee</span><span class="token punctuation">(</span>macbook<span class="token punctuation">)</span><span class="token punctuation">;</span>
macbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Freight</span><span class="token punctuation">(</span>macbook<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myMacbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Insurance</span><span class="token punctuation">(</span>macbook<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>再来看看实例2</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">ConcreteClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">performTask</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">preTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'doing something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">postTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">AbstractDecorator</span><span class="token punctuation">(</span><span class="token parameter">decorated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">performTask</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        decorated<span class="token punctuation">.</span><span class="token function">performTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">ConcreteDecoratorClass</span><span class="token punctuation">(</span><span class="token parameter">decorated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>base <span class="token operator">=</span> AbstractDecorator<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span>decorated<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// add performTask method</span>
    decorated<span class="token punctuation">.</span><span class="token function-variable function">preTask</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pre-calling..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    decorated<span class="token punctuation">.</span><span class="token function-variable function">postTask</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'post-calling..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> concrete <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> decorator1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteDecoratorClass</span><span class="token punctuation">(</span>concrete<span class="token punctuation">)</span><span class="token punctuation">;</span>
decorator1<span class="token punctuation">.</span><span class="token function">performTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//pre-calling..</span>
<span class="token comment">//doing something</span>
<span class="token comment">//post-calling..</span>
</code></pre></div><p>实例2实际上和实例1是非常类似的，我们来简单分析下吧。首先，实例2中定义了三个函数，然后声明了两个变量concrete和decorator1，最后调用了decorator1的performTask方法。</p> <p>粗看一眼，ConcreteDecoratorClass里面好像并没有performTask方法。我们先来分析下面的两行代码：</p> <p>然后，我们再来逐行分析下ConcreteDecoratorClass函数里面的代码：</p> <p>说到这里，好像还是没有分析出ConcreteDecoratorClass函数里面有performTask方法，重点是看 <strong>this</strong>！</p> <p>ConcreteDecoratorClass函数中的this指向new出来的ConcreteDecoratorClass对象（也就是和decorator1指向同一个对象）；
AbstractDecorator函数里面的this关键是看哪个对象来调用这个函数，this就指向哪个对象</p> <p><strong>this.base = AbstractDecorator; this.base(decorated)<strong>中我们可以看出是</strong>new出来的ConcreteDecoratorClass对象</strong>在调用AbstractDecorator函数）。</p> <p>所以AbstractDecorator函数里面的this指向new出来的ConcreteDecoratorClass对象（也和decorator1指向同一个对象）。
总结下来，我们会发现，在上面的代码中，<strong>不管是ConcreteDecoratorClass函数里面的this，还是AbstractDecorator函数里面的this，都指向new出来的ConcreteDecoratorClass对象</strong>。</p> <p>所以，当我们执行decorator1.performTask()时，它会继续执行匿名函数中的代码（decorated.performTask();），匿名函数中的decorated形参指向new出来的ConcreteClass对象，并执行该对象的performTask方法。</p> <p>再来看看实例3</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> tree <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
tree<span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Make sure the tree won'</span>t fall'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tree<span class="token punctuation">.</span><span class="token function-variable function">getDecorator</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">deco</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tree<span class="token punctuation">[</span>deco<span class="token punctuation">]</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">tree</span><span class="token punctuation">[</span>deco<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
tree<span class="token punctuation">.</span><span class="token function-variable function">RedApples</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">RedApples</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第7步：先执行原型（这时候是Angel了）的decorate方法</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Add some red apples'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第8步 再输出 red</span>
        <span class="token comment">// 将这2步作为RedApples的decorate方法</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
tree<span class="token punctuation">.</span><span class="token function-variable function">BlueApples</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">BlueApples</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第1步：先执行原型的decorate方法，也就是tree.decorate()</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Put on some blue apples'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第2步 再输出blue</span>
        <span class="token comment">// 将这2步作为BlueApples的decorate方法</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
tree<span class="token punctuation">.</span><span class="token function-variable function">Angel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">Angel</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第4步：先执行原型（这时候是BlueApples了）的decorate方法</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'An angel on the top'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第5步 再输出angel</span>
        <span class="token comment">// 将这2步作为Angel的decorate方法</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
tree <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getDecorator</span><span class="token punctuation">(</span><span class="token string">'BlueApples'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第3步：将BlueApples对象赋给tree，这时候父原型里的getDecorator依然可用</span>
tree <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getDecorator</span><span class="token punctuation">(</span><span class="token string">'Angel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第6步：将Angel对象赋给tree，这时候父原型的父原型里的getDecorator依然可用</span>
tree <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getDecorator</span><span class="token punctuation">(</span><span class="token string">'RedApples'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第9步：将RedApples对象赋给tree</span>
 
tree<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第10步：执行RedApples对象的decorate方法</span>
<span class="token comment">//Make sure the tree won't fall</span>
<span class="token comment">//Add blue apples</span>
<span class="token comment">//An angel on the top</span>
<span class="token comment">//Put on some red apples</span>
</code></pre></div><p>实例3看起来很复杂，实际上分析逻辑还是和前面两个实例一样，我们可以看出实例3中一共声明了5个函数表达式。我们重点分析下下面的代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//tree.getDecorator('BlueApples')返回new出来的tree.BlueApples的实例对象，并将该对象赋值给空的tree对象</span>
tree <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getDecorator</span><span class="token punctuation">(</span><span class="token string">'BlueApples'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//new出来的tree.BlueApples的实例对象的原型指向 --&gt; 空对象tree</span>
 
<span class="token comment">//tree.getDecorator('Angel')返回new出来的tree.Angel的实例对象（这行代码中的第二个tree已经是上面一行代码运行结果后的tree.BlueApples的实例对象）</span>
tree <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getDecorator</span><span class="token punctuation">(</span><span class="token string">'Angel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//new出来的tree.Angel的实例对象的原型指向 --&gt; tree.BlueApples的实例对象</span>
 
<span class="token comment">//tree.getDecorator('RedApples')返回new出来的tree.RedApples的实例对象（这行代码中的第二个tree已经是上面一行代码运行结果后的tree.Angel的实例对象）</span>
tree <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getDecorator</span><span class="token punctuation">(</span><span class="token string">'RedApples'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//new出来的tree.RedApples的实例对象的原型指向 --&gt; tree.Angel的实例对象</span>
 
<span class="token comment">//调用tree.decorate()，这里的tree已经是new出来的tree.RedApples的实例对象了。</span>
<span class="token comment">//tree.RedApples的实例对象的decorate属性方法里面的第一行代码是 “this.RedApples.prototype.decorate()”</span>
<span class="token comment">//结合上面的分析可以得出以下的原型链结构：</span>
<span class="token comment">//this.RedApples.prototype --&gt; tree.Angel;</span>
<span class="token comment">//tree.Angel.prototype --&gt; tree.BlueApples;</span>
<span class="token comment">//tree.BlueApples.prototype --&gt; 空对象tree</span>
tree<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>总结</strong></p> <p>装饰者模式是为已有功能动态地添加更多功能的一种方式，把每个要装饰的功能放在单独的函数里，然后用该函数包装所要装饰的已有函数对象，因此，当需要执行特殊行为的时候，调用代码就可以根据需要有选择地、按顺序地使用装饰功能来包装对象。优点是把类（函数）的核心职责和装饰功能区分开了。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/13/2020, 1:20:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/front/js/26.html" class="prev">
        javascript设计模式之工厂模式 ⭐️
      </a></span> <span class="next"><a href="/front/js/28.html">
        javascript设计模式之外观模式 ⭐
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.09cb6e35.js" defer></script><script src="/assets/js/2.925a6821.js" defer></script><script src="/assets/js/67.cd7385f8.js" defer></script>
  </body>
</html>
